{% extends 'base_generic.html' %}
{% load app_header %}
{% block nav %}
{% home_header %}
{% endblock %}
{% block content %}
<!-- Start Team -->
<div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
  <!-- Start Title -->
  <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
    {% if email_verified %}
    <h2 class="text-2xl font-bold md:text-4xl md:leading-tight">Email Already Verified</h2>
    {% else %}
    <h2 class="text-2xl font-bold md:text-4xl md:leading-tight">Verify Your Email</h2>
    <p class="mt-1 text-gray-600">Check your email to verify your account and get started.</p>
    {% endif %}
  </div>
  <!-- End Title -->

  {% if email_verified %}
  <!-- Already Verified Message -->
  <div class="max-w-2xl mx-auto text-center mb-6">
    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
      <svg class="mx-auto h-12 w-12 text-green-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <p class="text-green-800 font-medium text-lg">
        Your email address has been successfully verified. You can now log in and start using your account.
      </p>
    </div>
  </div>
  {% else %}
  <!-- Cooldown Timer Display -->
  {% if cooldown_active %}
  <div class="max-w-2xl mx-auto text-center mb-6">
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
      <p class="text-yellow-800 font-medium">
        You can request a new verification email in:
      </p>
      <p id="countdown-timer" class="text-2xl font-bold text-yellow-900 mt-2">
        Calculating...
      </p>
    </div>
  </div>
  {% endif %}
  {% endif %}

  <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
    {% if not email_verified %}
    <a href="{% url 'send_verification_email' %}"
       id="resend-button"
       class="inline-block bg-primary-600 text-white rounded-lg py-2 px-4 hover:bg-primary-700 mr-2 {% if cooldown_active %}opacity-50 cursor-not-allowed{% endif %}"
       {% if cooldown_active %}onclick="return false;"{% endif %}>
       Resend Email
    </a>
    {% endif %}
    <a href="{% url 'home' %}" class="inline-block bg-gray-600 text-white rounded-lg py-2 px-4 hover:bg-gray-700">Back to home</a>
  </div>
</div>

{% if cooldown_active and remaining_seconds %}
<script>
  // Initialize countdown with server-provided remaining seconds
  let remainingSeconds = parseInt('{{ remaining_seconds|default:"0" }}');
  const countdownElement = document.getElementById('countdown-timer');
  const resendButton = document.getElementById('resend-button');

  function updateCountdown() {
    if (remainingSeconds > 0) {
      const minutes = Math.floor(remainingSeconds / 60);
      const seconds = remainingSeconds % 60;

      let displayText = '';
      if (minutes > 0) {
        displayText = `${minutes} minute${minutes !== 1 ? 's' : ''} `;
      }
      displayText += `${seconds} second${seconds !== 1 ? 's' : ''}`;

      countdownElement.textContent = displayText;
      remainingSeconds--;

      // Continue countdown
      setTimeout(updateCountdown, 1000);
    } else {
      // Cooldown expired - enable the resend button
      countdownElement.textContent = 'Ready to resend!';
      resendButton.classList.remove('opacity-50', 'cursor-not-allowed');
      resendButton.classList.add('hover:bg-primary-700');
      resendButton.onclick = null;  // Re-enable clicking
    }
  }

  // Start the countdown
  updateCountdown();
</script>
{% endif %}
{% endblock %}
{% block footer %}
{% endblock %}